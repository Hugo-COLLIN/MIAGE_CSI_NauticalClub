@startuml
actor Client as C
actor "Garçon de plage" as G
actor "Moniteur" as M
actor "Propriétaire" as P
actor "Gestionnaire du système" as A
participant "SYSTEME" as App
participant "Base de donnees" as DB
participant ":Matériel" as Mat
participant ":Cours" as Cour
participant ":Forfait" as Forf
participant ":Camping" as Camp
participant ":Paiement" as Pay

title Workflow général de l'application du club nautique

A -> App : Créer un compte
activate A
activate App
App -> DB : Enregistrer nouveau compte
activate DB
DB --> App : Compte créé
deactivate DB
App --> A : Confirmation de création de compte
deactivate App
deactivate A

alt Inscription par le Moniteur
    M -> App : S'inscrire à un cours (niveau, forfait choisi)
    activate M
    activate App
else Inscription par le Propriétaire
    P -> App : S'inscrire à un cours (niveau, forfait choisi)
    activate P
end

activate App

App -> DB : Récupérer liste des cours disponibles
activate DB
DB --> App : Liste des cours disponibles
deactivate DB

alt Inscription par le Moniteur
    M -> App : Sélectionner un cours (date, horaire)
else Inscription par le Propriétaire
    P -> App : Sélectionner un cours (date, horaire)
end

App -> DB : Vérifier disponibilité du moniteur et du matériel
activate DB
DB -> Mat : Vérifier statut du matériel
activate Mat
Mat --> DB : Matériel disponible
deactivate Mat

alt Inscription par le Moniteur
    M -> App : Indiquer affiliation à un camping partenaire
else Inscription par le Propriétaire
    P -> App : Indiquer affiliation à un camping partenaire
end

DB -> Camp : Vérifier affiliation
activate Camp
Camp --> DB : Remise confirmée (10%)
deactivate Camp

DB --> App : Disponibilité et remise confirmées
deactivate DB

C -> App : Saisir les informations de paiement
activate C
activate App
App -> Pay : Lancer le paiement (prix ajusté)
activate Pay
Pay --> App : Paiement validé
deactivate Pay
App --> C : Paiement validé
deactivate C
deactivate App

App -> DB : Enregistrer inscription
activate DB
DB -> Mat : Réserver matériel pour le cours
activate Mat
Mat --> DB : Réservation confirmée
deactivate Mat
DB --> App : Inscription enregistrée
deactivate DB

alt Inscription par le Moniteur
    App -> M : Notifier le moniteur (détails du cours)
    activate M
    M --> App : Confirmation réception
    deactivate M
else Inscription par le Propriétaire
    App -> P : Notifier le propriétaire (détails du cours)
    activate P
    P --> App : Confirmation réception
    deactivate P
end

App -> P : Envoyer rapport de l'inscription
activate P
P --> App : Accusé de réception
deactivate P

alt Inscription par le Moniteur
    App --> M : Envoyer confirmation d'inscription (détails cours, remise, reçu)
    deactivate M
else Inscription par le Propriétaire
    App --> P : Envoyer confirmation d'inscription (détails cours, remise, reçu)
    deactivate App
    deactivate P
end
@enduml
